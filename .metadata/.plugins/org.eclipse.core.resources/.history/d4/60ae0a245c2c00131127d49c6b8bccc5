/*
 * lab1_phase2.c
 *
 *  Created on: 2013-10-03
 *      Author: h53huang
 */

void init(int, int);
void background(int);
void finalize(void);
#include "system.h"
#include <io.h>
// our test
int main(void)
{
	int i;
	int flag;
	flag = false;
	//period and duty cycles should not exceed 14
	init(6, 8);
	for(i=0; i<100; i++)
	{
		int j;
		while(flag == false) {
			for(j = 100; j > 0; j--)
			{
				if(IORD(PIO_PULSE_BASE, 0) == 0){
					flag = true;
					break;
				}
				background(j);
			}
			if(!flag){
				while(IORD(PIO_PULSE_BASE, 0) == 0) {}
			}
			flag = true;
		}
		IOWR(PIO_RESPONSE_BASE, 0, 1);
		//background(200);
		flag = false;
		while(flag == false) {
			for(j = 100; j > 0; j--)
			{
				if(IORD(PIO_PULSE_BASE, 1) == 0){
					flag = true;
					break;
				}
				background(j);
			}
			if(!flag){
				while(IORD(PIO_PULSE_BASE, 0) == 1) {}
			}
			flag = true;
		}
		//while(IORD(PIO_PULSE_BASE, 0) == 1) {}
		IOWR(PIO_RESPONSE_BASE, 0, 0);
	}
	finalize();
}
